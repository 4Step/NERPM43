; Do not change filenames or add or remove FILEI/FILEO statements using an editor. Use Cube/Application Manager.
RUN PGM=HIGHWAY PRNFILE="{SCENARIO_DIR}\output\PAHWY00D.PRN" MSG='Preassignment'
FILEI NETI = "{SCENARIO_DIR}\output\UNLOADED.NET"
FILEI MATI[1] = "{SCENARIO_DIR}\output\PRELOAD.MAT"
FILEO PRINTO[1] = "{SCENARIO_DIR}\output\PAHWY00B.PRN"
FILEI TURNPENI = "{CATALOG_DIR}\parameters\tcards.pen"
FILEO NETO = "{SCENARIO_DIR}\output\PAHWY00A.NET"

 DistributeINTRASTEP ProcessID='JTADist', ProcessList=1-3

PAR ZONEMSG=100 MAXITERS={ITER} GAP=0.0000005 RAAD=0.0000 AAD=0.00000 RMSE=0.000000

; look up deceleration rate based on approach speed
LOOKUP,
 INTERPOLATE=Y, LIST=Y, NAME=DECEL,
        LOOKUP[1]=1,RESULT=2,
R = '30 4',
    '70 6.2'

PROCESS PHASE=LINKREAD
  LW.DISTANCE=LI.DISTANCEFT/5280
  LW.FFTIME=LI.TIME ; USE FOR PRELOAD PURPOSES (FFTIME)
  C=LI.CAPACITY*LI.NUM_LANES*LI.UROADFACTOR/LI.CONFAC
  IF (li.FACILITY_TYPE=80-89) ADDTOGROUP=1
  IF (li.EECODE>0) ADDTOGROUP=2
  IF (li.FACILITY_TYPE=49 | LI.FACILITY_TYPE=59 | LI.FACILITY_TYPE=69) ADDTOGROUP=9

  T0=li.TIME + ({CTOLL}*LI.CARTOLL)*60  ; revised time includes toll in the cost function

ENDPROCESS

; IE trips see TIME (weighted time) not just the free flow time in the cost function
PROCESS PHASE=ILOOP
  PATHLOAD PATH=TIME, PENI=1, VOL[1]=MI.1.1, VOL[2]=MI.1.2, EXCLUDEGROUP=1,9
  PATHLOAD PATH=TIME, PENI=1, VOL[3]=MI.1.3, EXCLUDEGROUP=9
  PATHLOAD PATH=TIME, PENI=1, VOL[4]=MI.1.4, VOL[5]=MI.1.5,  EXCLUDEGROUP=1-2,9
  PATHLOAD PATH=TIME, PENI=1, VOL[6]=MI.1.6, EXCLUDEGROUP=2,9
ENDPROCESS


PROCESS PHASE=ADJUST

 FUNCTION   TC=LI.TIME*(1+LI.BPRCOEFFICIENT*MIN((V/C),10)^LI.BPREXPONENT) + {CTOLL}*LI.CARTOLL*60   ; congested time includes time equivalent of toll

if (li.cartoll>0) print list="Iter:",iteration(2.0)," TOLLFM Summary, A=",A(6.0)," B=",B(6.0)," PLAZAID=",li.TOLL(3.0)," NAME=",li.PLAZADESC(24)," MAX LNS=",li.PLZALNSMAX," GCOST=",TIME(6.2),
        printo=1


ENDPROCESS


ENDRUN
