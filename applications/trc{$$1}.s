; Script for program PUBLIC TRANSPORT in file "C:\NERPM50\applications\CNPTR00A.S"
; Do not change filenames or add or remove FILEI/FILEO statements using an editor. Use Cube/Application Manager.
RUN PGM=PUBLIC TRANSPORT PRNFILE="{SCENARIO_DIR}\output\CNPTR00A.PRN" MSG='Peak period connectors'
FILEI FACTORI[1] = "{SCENARIO_DIR}\output\WalkPrj.FAC"
FILEI FAREI = "{SCENARIO_DIR}\input\TFARES_{year}{alt}.FAR"
FILEI SYSTEMI = "{CATALOG_DIR}\parameters\SYSTEM.PTS"
FILEI LINEI[1] = "{SCENARIO_DIR}\input\TROUTE_{year}{alt}.LIN"
FILEI NETI = "{SCENARIO_DIR}\output\PRELOAD_PT.NET"

FILEO LINEO = "{SCENARIO_DIR}\output\TROUTE_MOD.LIN"
FILEO LINKO[1] = "{SCENARIO_DIR}\output\NTLEGPK_{alt}{year}.DBF",
ONOFFS=T,NTLEGS=N
FILEO NTLEGO = "{SCENARIO_DIR}\output\NTLEGPK_{YEAR}{ALT}.NTL"
FILEO REPORTO = "{SCENARIO_DIR}\output\NTLEGPK.RPT"
FILEO NETO = "{SCENARIO_DIR}\output\NTLEGSPK.NET"


; OVERALL PARAMETERS OF RUN
PARAMETERS USERCLASSES=1,FARE=N, MAPSCALE=5280, HDWAYPERIOD=1,
           NOROUTEERRS=999999, NOROUTEMSGS=999999,
           TRANTIME=LW.TRANTIME,
           TRANTIME[21]=LI.M21TIMEPK,
           TRANTIME[22]=LI.M22TIMEPK,
           TRANTIME[23]=LI.M23TIMEPK,
           TRANTIME[27]=LI.M27TIMEPK

REPORT LINES=T
PROCESS PHASE=LINKREAD
 LW.TRANTIME=LI.M21TIMEPK
 LW.WALKTIME=LI.WALKTIME
 LW.WALKDISTANCE=LI.DISTANCE
 LW.DISTANCE=LI.DISTANCE
 LW.ADJDISTANCE=LI.ADJDISTANCE
ENDPROCESS

PROCESS PHASE=DATAPREP

  ; 1 - WALK ACCESS/EGRESS
  GENERATE, COST=(LW.ADJDISTANCE),EXTRACTCOST=(LW.WALKTIME),MAXCOST=200*{WALKACCESSDIST},LIST=N,EXCLUDELINK=(LI.FACILITY_TYPE=10-19,69,70-99),
            NTLEGMODE=1,MAXNTLEGS=200*{MAXWLKACCLNKS},DIRECTION=3,ONEWAY=F,FROMNODE=1-{ZONESI},TONODE={NODEMIN}-99999
; also include 3 mile connectors from BRT stations

  ; 2 - GENERATE AUTO CONNECTORS TO PNR LOTS
  ; generated by AUTOCON program

  ; 3 - GENERATE KNR CONNECTORS TO ALL BUS STOPS
  ; min length 0.6 miles; max length 3.0 miles
  GENERATE, COST=(LW.DISTANCE),EXTRACTCOST=LI.TIME_1,MINCOST=200*0.6,MAXCOST=200*3,LIST=N,NTLEGMODE=3,
            EXCLUDELINK=(LI.AREA_TYPE=11-21),MAXNTLEGS=200*1,DIRECTION=1,ONEWAY=T,
            FROMNODE=1-{ZONESI}, TONODE={NODEMIN}-99999

  ; 4 - ALL-WALKS
;  GENERATE, COST=(LW.DISTANCE),EXTRACTCOST=(LW.WALKTIME),MAXCOST=200*7,LIST=N,EXCLUDELINK=(LI.FACILITY_TYPE=10-19,69,70-99),
;            NTLEGMODE=4,MAXNTLEGS=200*{MAXWLKACCLNKS},DIRECTION=3,ONEWAY=F,FROMNODE=1-{ZONESI},TONODE=1-{ZONESI}

  ; 5 - FRINGE PNR ACCESS TO SKYWAY/TROLLEY
  READ, FILE = "{SCENARIO_DIR}\OUTPUT\FRINGEPNRPK.TXT"

  ; 6 - CBD KNR ACCESS TO BUS (to FCCJ downtown, pearl/independence, pearl/bay, pearl/forsyth)
  ; READ, FILE = "{SCENARIO_DIR}\output\FringeKNRBusPK.TXT" ; - this list Fringe KNR to all CBD Stations
  GENERATE, COST=(LW.DISTANCE),EXTRACTCOST=(li.time_1+li.svcminutes+li.svcseconds/60+li.cartoll*{ctoll}*60),
     MINCOST=200*3,MAXCOST=200*7,LIST=N,MAXNTLEGS=200*2, NTLEGMODE=6,
     DIRECTION=1,ONEWAY=T,FROMNODE=1-{ZONESI},TONODE={DowntownKNRNodes}

  ; 11 - Fixed-guideway to bus (transfer connectors)
  GENERATE, COST=(LW.DISTANCE),EXTRACTCOST=(LI.WALKTIME),MAXCOST=200*{WALKACCESSDIST},LIST=N,INCLUDELINK=(LI.FACILITY_TYPE=59),
            NTLEGMODE=11,MAXNTLEGS=200*{MAXWLKACCLNKS},DIRECTION=3,DIRECTLINK=2,ONEWAY=F,FROMNODE={NODEMIN}-99999,TONODE={NODEMIN}-99999
  ; 11 - station to nearby stop (transfer connectors)
  READ, FILE = "{SCENARIO_DIR}\OUTPUT\STATXFER_TMP.DAT"

  ; 12 - CBD sidewalks
   READ, FILE = "{SCENARIO_DIR}\OUTPUT\CBDXFER.DAT"

ENDPROCESS


ENDRUN


; Added Autocon program
; Do not change filenames or add or remove FILEI/FILEO statements using an editor. Use Cube/Application Manager.
RUN PGM=PUBLIC TRANSPORT PRNFILE="{CATALOG_DIR}\APPLICATIONS\TPPTR00C.PRN" MSG='Generate PK PNR & KNR Links'
FILEI MATI[1] = "{SCENARIO_DIR}\output\PRELSKIMS.MAT"
FILEI FACTORI[1] = "{SCENARIO_DIR}\output\PNRPrj.FAC"
FILEI FAREI = "{SCENARIO_DIR}\input\TFARES_{year}{alt}.FAR"
FILEI SYSTEMI = "{CATALOG_DIR}\parameters\SYSTEM.PTS"
FILEI LINEI[1] = "{SCENARIO_DIR}\input\TROUTE_{year}{alt}.LIN"
FILEI NETI = "{SCENARIO_DIR}\output\PRELOAD_PT.NET"

FILEO PRINTO[2] = "{SCENARIO_DIR}\OUTPUT\PT_AUTOCON_PK.OUT"
FILEO PRINTO[1] = "{SCENARIO_DIR}\OUTPUT\NTLEG2PK_{ALT}{Year}.PRN"
FILEO NTLEGO = "{SCENARIO_DIR}\OUTPUT\NTLEG2PK_{ALT}{Year}.NTL"
FILEO NETO = "{SCENARIO_DIR}\OUTPUT\NTLEG2PK_{ALT}{Year}.NET"

; OVERALL PARAMETERS OF RUN
PARAMETERS USERCLASSES=1,FARE=N, MAPSCALE=5280,, HDWAYPERIOD=1,
           NOROUTEERRS=999999, NOROUTEMSGS=999999,
           TRANTIME=LW.TRANTIME,
           TRANTIME[21]=LI.M21TIMEPK,
           TRANTIME[22]=LI.M22TIMEPK,
           TRANTIME[23]=LI.M23TIMEPK,
           TRANTIME[27]=LI.M27TIMEPK

REPORT LINES=T
PROCESS PHASE=LINKREAD
   LW.TRANTIME=LI.M21TIMEPK
   LW.WALKTIME=LI.WALKTIME
   LW.WALKDISTANCE=LI.DISTANCE
   LW.DISTANCE=LI.DISTANCE
   LW.ADJDISTANCE=LI.ADJDISTANCE
   LW.CGS_TIME=LI.TIME_1
ENDPROCESS

PROCESS PHASE=DATAPREP
; GENERATE AUTO CONNECTORS FOR PNR AND KNR
   list='\nGenerate Zone Access/Egress Legs'
   GENERATE, 
      PNR=T,
      KNR=T,
      PERIOD=1,
      
      PNRMODE=2,
      KNRMODE=3,
      INTERNALZONES=1-{zonesi},
      
      CBDZONE={CBDZONE},
      ORIGINTERMTIME=2.0,
      DEFDRIVETIME=2.0,
      CHECKRELEVANCE=1,
      CHECKBACKTRACK=1,
      MAXBACKDIST=4.0,
      MAXBACKFACTOR=0.30,
      DISTANCEFACTOR=5280,
      
      PREMIUMMODE=0,1,0,1,1,1,1,  
      MODEPRIORITY=7,5,7,2,1,4,3,
      
      VOT=6,3,
      OVTRATIO=2,2,
      AATRATIO=1.5,1.5,
      AUTOCCPNR={OCCPNRAccess},
      AUTOCCKNR={OCCPNRAccess},
      AOC={hwyopcost},
      INFLTRANSITFARE={InflationFare},
      INFLAOC={InflationAOC},
      INFLPARKINGCOST={InflationParkCost},
      MAXCHECK = 2,
      MAXCONN = 2,
      
      CONNREPORT=1,
      GENREPORT=2,
      TIMEMAT=MI.1.4,
      DISTMAT=MI.1.2,
      AUTOMATCH=T      ; T=original logic, F=Enhanced logic

ENDPROCESS


ENDRUN



