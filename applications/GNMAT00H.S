; Do not change filenames or add or remove FILEI/FILEO statements using an editor. Use Cube/Application Manager.
RUN PGM=MATRIX PRNFILE="C:\NERPM43\APPLICATIONS\GNMAT00E.PRN" MSG='Prepare zonal data for county level summary'
FILEI ZDATI[1] = "{SCENARIO_DIR}\input\ZDATA_{year}{alt}.DBF"
FILEO RECO[1] = "{SCENARIO_DIR}\output\SelectedZdata.DBF",
   FIELDS= TAZ,DESCR,COUNTY, ;,SFDU,SFSEAS,SFVAC,SFPOP,SF0CAR,SF1CAR,SF2CAR,SF3CAR,MFDU,MFSEAS,
           ;MFVAC,MFPOP,MF0CAR,MF1CAR,MF2CAR,MF3CAR,HMUNITS,HMPCTOCC,HMPOP,EMPMFG,EMPIND,EMPCOM,EMPSVC,EMPTOT,SCHENR,STPKCST,LTPKCST,
           TOTALDUS,TOTALDUS3,HHOCCU,HHTGOCC,POPTOT,ALLPOP,TOTEMP
      

PAR ZONES={ZONESI} ZONEMSG=100


;LOOKUP, NAME=TERM, LOOKUP[1]=1, RESULT=2, INTERPOLATE=N, LOOKUPI=1, FAIL=0

;N=ZI.1.TAZ


RO.TAZ=ZI.1.TAZ
RO.DESCR=ZI.1.DESCRIPTIO
RO.SFDU=ZI.1.SFDU
RO.SFSEAS=ZI.1.SFSEAS
RO.SFVAC=ZI.1.SFVAC
RO.SFPOP=ZI.1.SFPOP 
RO.SF0CAR=ZI.1.SF0CAR
RO.SF1CAR=ZI.1.SF1CAR
RO.SF2CAR=ZI.1.SF2CAR
RO.SF3CAR=ZI.1.SF3CAR
RO.MFDU=ZI.1.MFDU
RO.MFSEAS=ZI.1.MFSEAS
RO.MFVAC=ZI.1.MFVAC
RO.MFPOP=ZI.1.MFPOP
RO.MF0CAR=ZI.1.MF0CAR
RO.MF1CAR=ZI.1.MF1CAR
RO.MF2CAR=ZI.1.MF2CAR
RO.MF3CAR=ZI.1.MF3CAR
RO.HMUNITS=ZI.1.HMUNITS
RO.HMPCTOCC=ZI.1.HMPCTOCC
RO.HMPOP=ZI.1.HMPOP
RO.EMPMFG=ZI.1.EMPMFG
RO.EMPIND=ZI.1.EMPIND
RO.EMPCOM=ZI.1.EMPCOM
RO.EMPSVC=ZI.1.EMPSVC
RO.EMPTOT=ZI.1.EMPTOT
RO.SCHENR=ZI.1.SCHENR
RO.STPKCST=ZI.1.STPKCST
RO.LTPKCST=ZI.1.LTPKCST

RO.COUNTY=ZI.1.COUNTY

;ReSet Data for Internal Dummy Zones to County value of 9
if(z=25-33,89-98,128-137) COUNTY=9  ;Nassau
if(z=207-225,336-352,364-368,376-380,403-407,578-588,772-780,961-974,978-981,1124-1139,1937,2012,2043,2323,2324) COUNTY=9    ;Duval
if(z=1164-1173,1183-1192,1214-1227,1238-1250,1264-1275,1294-1303,1349-1362,1378-1392,2386-2400) COUNTY=9    ;St Johns
if(z=1407-1411,1422-1430,1442-1450,1490-1498,1509-1518,1524-1533,1570-1577,1589-1593,1607-1616,1620-1899) COUNTY=9    ;Clay
if(z=1458,1547-1549) COUNTY=9    ;Clay
if(z=2430-2450) COUNTY=9    ;Baker
if(z=2495-2549) COUNTY=9    ;Putnam


;Caluculate total DU, occupied DU (HHs), population and employment...

TOTALDUS=ZI.1.SFDU+ZI.1.MFDU                               ;Total SF & MH DUs
TOTALDUS3=ZI.1.SFDU+ZI.1.MFDU+ZI.1.HMUNITS                 ;Total DUS including HM units

HHOCCU_SU=ZI.1.SFDU-(ZI.1.SFDU*(ZI.1.SFSEAS/100))
HHOCCU_MU=ZI.1.MFDU-(ZI.1.MFDU*(ZI.1.MFSEAS/100))
HHOCCU=HHOCCU_SU+HHOCCU_MU                                 ;permanently occupied DUs

HHOCCTG_SU=ZI.1.SFDU-(ZI.1.SFDU*(ZI.1.SFVAC/100))
HHOCCTG_MU=ZI.1.MFDU-(ZI.1.MFDU*(ZI.1.MFVAC/100))
HHOCCTG_HM=ZI.1.HMUNITS-(ZI.1.HMUNITS*((100-ZI.1.HMPCTOCC)/100))  
HHTGOCC=HHOCCTG_SU+HHOCCTG_MU+HHOCCTG_HM                   ;total occupied DUs including HMs

POPTOT=ZI.1.SFPOP+ZI.1.MFPOP                               ;Permanent Population  
ALLPOP=POPTOT+ZI.1.HMPOP                                   ;Total Population including HM persons

TOTEMP=ZI.1.EMPMFG+ZI.1.EMPIND+ZI.1.EMPCOM+ZI.1.EMPSVC     ;Total employment

WRITE RECO=1

;External Zones
if(z={ZONESI})
  loop jj={ZONESI}+1,{ZONESA}
    TAZ=jj

    if (TAZ=2550-2553) COUNTY=1    ;Nassau External
    if (TAZ=2554-2563) COUNTY=5    ;Baker External
    if (TAZ=2564-2568) COUNTY=4    ;Clay External
    if (TAZ=2569-2575) COUNTY=6    ;Putnam External
    if (TAZ=2576-2578) COUNTY=3    ;St. Johns External


    RO.DESCR='EXTERNAL'
    RO.SFDU=0
    RO.SFSEAS=0
    RO.SFVAC=0
    RO.SFPOP=0 
    RO.SF0CAR=0
    RO.SF1CAR=0
    RO.SF2CAR=0
    RO.SF3CAR=0
    RO.MFDU=0
    RO.MFSEAS=0
    RO.MFVAC=0
    RO.MFPOP=0
    RO.MF0CAR=0
    RO.MF1CAR=0
    RO.MF2CAR=0
    RO.MF3CAR=0
    RO.HMUNITS=0
    RO.HMPCTOCC=0
    RO.HMPOP=0
    RO.EMPMFG=0
    RO.EMPIND=0
    RO.EMPCOM=0
    RO.EMPSVC=0
    RO.EMPTOT=0
    RO.SCHENR=0
    RO.STPKCST=0
    RO.LTPKCST=0

    TOTALDUS=0    ;Total SF & MH DUs
    TOTALDUS3=0   ;Total DUS including HM units
    HHOCCU=0      ;permanently occupied DUs
    HHTGOCC=0     ;total occupied DUs including HMs
    POPTOT=0      ;Permanent Population  
    ALLPOP=0      ;Total Population including HM persons
    TOTEMP=0      ;Total employment

    WRITE RECO=1
 
  endloop
endif





ENDRUN
