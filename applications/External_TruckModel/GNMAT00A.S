; Do not change filenames or add or remove FILEI/FILEO statements using an editor. Use Cube/Application Manager.
RUN PGM=MATRIX PRNFILE="{SCENARIO_DIR}\output\GNMAT00A.PRN" MSG='Subarea Balancing of Attractions Rates'
FILEI RECI = "{SCENARIO_DIR}\output\PANDA_TEM.DBF"
FILEO PRINTO[1] = "{SCENARIO_DIR}\output\SUBAREABAL.CSV"
FILEO RECO[1] = "{SCENARIO_DIR}\output\PANDA.DBF",
FIELDS=Z,DISTRICT,HBWKP,HBWKA,HBSHP,HBSHA,HBSRP,HBSRA,HBOTP,HBOTA,NHBSP,NHBSA,
LTRKP,LTRKA,MTRKP,MTRKA,HTRKP,HTRKA,SOIEP,SOIEA,HOIEP,HOIEA,LDIEP,LDIEA,HDIEP,HDIEA

PAR ZONES={ZONESA}, ZONEMSG=100
;ARRAY P1=5,P2=5,P3=5,P4=5,P5=5,P6=5,P7=5,P8=5,P9=5,P10=5,P11=5,P12=5,
; A1=5,A2=5,A3=5,A4=5,A5=5,A6=5,A7=5,A8=5,A9=5,A10=5,A11=5,A12=5, DSTS={ZONESA}
ARRAY P1=8,P2=8,P3=8,P4=8,P5=8,P6=8,P7=8,P8=8,P9=8,P10=8,P11=8,P12=8,
 A1=8,A2=8,A3=8,A4=8,A5=8,A6=8,A7=8,A8=8,A9=8,A10=8,A11=8,A12=8, DSTS={ZONESA}


READ,
 FILE = "{CATALOG_DIR}\PARAMETERS\ATTRDIST.SYN"
RO.DISTRICT=DST
DSTS[RI.Z]=RO.DISTRICT
RO.HBWKP=RI.P1
RO.HBWKA=RI.A1
RO.HBSHP=RI.P2
RO.HBSHA=RI.A2
RO.HBSRP=RI.P3
RO.HBSRA=RI.A3
RO.HBOTP=RI.P4
RO.HBOTA=RI.A4
RO.NHBSP=RI.P5
RO.NHBSA=RI.A5
RO.LTRKP=RI.P6
RO.LTRKA=RI.A6
RO.MTRKP=RI.P7
RO.MTRKA=RI.A7
RO.HTRKP=RI.P8
RO.HTRKA=RI.A8
RO.SOIEP=RI.P9
RO.SOIEA=RI.A9
RO.HOIEP=RI.P10
RO.HOIEA=RI.A10
RO.LDIEP=RI.P11
RO.LDIEA=RI.A11
RO.HDIEP=RI.P12
RO.HDIEA=RI.A12
  WRITE RECO=1


; CREATE DISTRICT TOTALS OF PRODUCTIONS AND ATTRACTIONS TO APPLY AS FACTORS LATER
; (creates sub-area balancing of attractions
P1[RO.DISTRICT]=P1[RO.DISTRICT]+RO.HBWKP, A1[RO.DISTRICT]=A1[RO.DISTRICT]+RO.HBWKA
P2[RO.DISTRICT]=P2[RO.DISTRICT]+RO.HBSHP, A2[RO.DISTRICT]=A2[RO.DISTRICT]+RO.HBSHA
P3[RO.DISTRICT]=P3[RO.DISTRICT]+RO.HBSRP, A3[RO.DISTRICT]=A3[RO.DISTRICT]+RO.HBSRA
P4[RO.DISTRICT]=P4[RO.DISTRICT]+RO.HBOTP, A4[RO.DISTRICT]=A4[RO.DISTRICT]+RO.HBOTA
P5[RO.DISTRICT]=P5[RO.DISTRICT]+RO.NHBSP, A5[RO.DISTRICT]=A5[RO.DISTRICT]+RO.NHBSA
P6[RO.DISTRICT]=P6[RO.DISTRICT]+RO.LTRKP, A6[RO.DISTRICT]=A6[RO.DISTRICT]+RO.LTRKA
P7[RO.DISTRICT]=P7[RO.DISTRICT]+RO.MTRKP, A7[RO.DISTRICT]=A7[RO.DISTRICT]+RO.MTRKA
P8[RO.DISTRICT]=P8[RO.DISTRICT]+RO.HTRKP, A8[RO.DISTRICT]=A8[RO.DISTRICT]+RO.HTRKA
P9[RO.DISTRICT]=P9[RO.DISTRICT]+RO.SOIEP, A9[RO.DISTRICT]=A9[RO.DISTRICT]+RO.SOIEA
P10[RO.DISTRICT]=P10[RO.DISTRICT]+RO.HOIEP, A10[RO.DISTRICT]=A10[RO.DISTRICT]+RO.HOIEA
P11[RO.DISTRICT]=P11[RO.DISTRICT]+RO.LDIEP, A11[RO.DISTRICT]=A11[RO.DISTRICT]+RO.LDIEA
P12[RO.DISTRICT]=P12[RO.DISTRICT]+RO.HDIEP, A12[RO.DISTRICT]=A12[RO.DISTRICT]+RO.HDIEA
DST=RO.DISTRICT

;SKS-Override P's and A's total for Dummy districts for subarea balancing factors t=8, see ATTRDIST.SYN file in parameters folder)
if (DST=8)
   P1[8]=1.0
   A1[8]=1.0
   P2[8]=1.0
   A2[8]=1.0
   P3[8]=1.0
   A3[8]=1.0
   P4[8]=1.0
   A4[8]=1.0
   P5[8]=1.0
   A5[8]=1.0
   P6[8]=1.0
   A6[8]=1.0
   P7[8]=1.0
   A7[8]=1.0
   P8[8]=1.0
   A8[8]=1.0
   P9[8]=1.0
   A9[8]=1.0
   P10[8]=1.0
   A10[8]=1.0
   P11[8]=1.0
   A11[8]=1.0
   P12[8]=1.0
   A12[8]=1.0
endif  

; PUT IN TO MORE OR LESS REPRODUCE Sub-area Balancing
IF (RI.Z={ZONESA})
   LOOP WW=1,{ZONESA}
   RO.DISTRICT=DSTS[WW]
   if(RO.DISTRICT<>1)
      PRINT CSV=T, LIST=WW(6.0),RO.DISTRICT(3.0),
                P1[RO.DISTRICT]/A1[RO.DISTRICT](12.8),
                P2[RO.DISTRICT]/A2[RO.DISTRICT](12.8),
                P3[RO.DISTRICT]/A3[RO.DISTRICT](12.8),
                P4[RO.DISTRICT]/A4[RO.DISTRICT](12.8),
                P5[RO.DISTRICT]/A5[RO.DISTRICT](12.8),
                P6[RO.DISTRICT]/A6[RO.DISTRICT](12.8),
                P7[RO.DISTRICT]/A7[RO.DISTRICT](12.8),
                P8[RO.DISTRICT]/A8[RO.DISTRICT](12.8),
                P9[RO.DISTRICT]/A9[RO.DISTRICT](12.8),
                P10[RO.DISTRICT]/A10[RO.DISTRICT](12.8),
                P11[RO.DISTRICT]/A11[RO.DISTRICT](12.8),
                P12[RO.DISTRICT]/A12[RO.DISTRICT](12.8), PRINTO=1
    else
       PRINT CSV=T, LIST=WW(6.0),RO.DISTRICT(3.0),
                P1[RO.DISTRICT]/A1[RO.DISTRICT](12.8),
                P2[RO.DISTRICT]/A2[RO.DISTRICT](12.8),
                P3[RO.DISTRICT]/A3[RO.DISTRICT](12.8),
                P4[RO.DISTRICT]/A4[RO.DISTRICT](12.8),
                P5[RO.DISTRICT]/A5[RO.DISTRICT](12.8),
                P6[RO.DISTRICT]/A6[RO.DISTRICT](12.8),
                P7[RO.DISTRICT]/A7[RO.DISTRICT](12.8),
                P8[RO.DISTRICT]/A8[RO.DISTRICT](12.8),
      (P9[1]+P9[2]+P9[3]+P9[4]+P9[5]+P9[6]+P9[7])/(A9[1]+A9[2]+A9[3]+A9[4]+A9[5]+A9[6]+A9[7])(12.8),
      (P10[1]+P10[2]+P10[3]+P10[4]+P10[5]+P10[6]+P10[7])/(A10[1]+A10[2]+A10[3]+A10[4]+A10[5]+A10[6]+A10[7])(12.8),
      (P11[1]+P11[2]+P11[3]+P11[4]+P11[5]+P11[6]+P11[7])/(A11[1]+A11[2]+A11[3]+A11[4]+A11[5]+A11[6]+A11[7])(12.8),
      (P12[1]+P12[2]+P12[3]+P12[4]+P12[5]+P12[6]+P12[7])/(A12[1]+A12[2]+A12[3]+A12[4]+A12[5]+A12[6]+A12[7])(12.8), PRINTO=1
    endif
    ENDLOOP

ENDIF
ENDRUN
