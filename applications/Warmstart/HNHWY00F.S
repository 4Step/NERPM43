; Do not change filenames or add or remove FILEI/FILEO statements using an editor. Use Cube/Application Manager.
RUN PGM=HIGHWAY PRNFILE="C:\NERPM43\APPLICATIONS\WARMSTART\HNHWY00F.PRN" MSG='Develop MD Congested Skims'
FILEI LOOKUPI[1] = "C:\NERPM43\APPLICATIONS\WARMSTART\TERMTIME.CSV"
FILEI NETI = "C:\NERPM43\APPLICATIONS\WARMSTART\PreAssign_MD2.NET"
FILEI TURNPENI = "C:\NERPM43\APPLICATIONS\WARMSTART\TCARDS_10A.PEN"
FILEO MATO[1] = "C:\NERPM43\APPLICATIONS\WARMSTART\CONGSKIM_{ALT}{Year}_MD.MAT",
    MO=1-9,NAME=STOLL,SDISTANCE,STIME,STERMINALTIME,STIME2,HTOLL,HDISTANCE,HTIME,HTIME2

PAR ZONEMSG=100

; ARRAY TERMINAL TIMES INTO MEMORY
ARRAY ATYPE={ZONESA}
LOOKUP, NAME=TERMTIME, LOOKUP[1]=1, RESULT=2, INTERPOLATE=N, LOOKUPI=1
PROCESS PHASE=LINKREAD
   lw.distance=li.distanceft/5280; CONVERTS DISTANCES FROM NETWORK (FEET) TO MILES FOR SKIMS
   IF (LI.FACILITY_TYPE=80-89) ADDTOGROUP=1
   IF (LI.FACILITY_TYPE=49 | LI.FACILITY_TYPE=59 | LI.FACILITY_TYPE=69) ADDTOGROUP=9   ; AK-these are transit only links/fixed guideways
   IF (A<={ZONESA})  ; FLAGS LAST ENCOUNTERED LINK FOR TERMINAL TIME CALCULATION LATER
        ATYPE[A]=LI.AREA_TYPE
        PRINT LIST=A,LI.AREA_TYPE
   ENDIF
   LW.TIME=li.time+li.svcminutes+li.svcseconds/60+li.cartoll*{ctoll}*60
ENDPROCESS

PROCESS PHASE=ILOOP
  PATHLOAD PATH=LI.TIME, PENI={PENSET}, ;Pathload for nonHOV path
      MW[1]=PATHTRACE(LI.CARTOLL),NOACCESS=99999,
      MW[2]=PATHTRACE(LI.DISTANCE),NOACCESS=99999, 
      MW[3]=PATHTRACE(LI.TIME),NOACCESS=99999,
      MW[5]=PATHTRACE(LW.TIME),NOACCESS=99999,
      EXCLUDEGROUP=1,9
  PATHLOAD PATH=LI.TIME, PENI={PENSET}, ;Pathload including HOV path
      MW[6]=PATHTRACE(LI.CARTOLL),NOACCESS=99999,
      MW[7]=PATHTRACE(LI.DISTANCE),NOACCESS=99999,
      MW[8]=PATHTRACE(LI.TIME),NOACCESS=99999, 
      MW[9]=PATHTRACE(LW.TIME),NOACCESS=99999,
      EXCLUDEGROUP=9
      

  IF(I<={ExtZnStrt})
    MW[1][I]=LOWEST(1,{IZZONE})/({IZZONE}*2) ; INTRAZONAL nonHOV TOLL = 1/2 THE AVERAGE OF THE {IZZONE} NEAREST ZONES
    MW[2][I]=LOWEST(2,{IZZONE})/({IZZONE}*2) ; INTRAZONAL nonHOV DISTANCE = 1/2 THE AVERAGE OF THE {IZZONE} NEAREST ZONES
    MW[3][I]=LOWEST(3,{IZZONE})/({IZZONE}*2) ; INTRAZONAL nonHOV TIME = 1/2 THE AVERAGE OF THE {IZZONE} NEAREST ZONES
    MW[5][I]=LOWEST(5,{IZZONE})/({IZZONE}*2) ; INTRAZONAL nonHOV TIME+TOLL = 1/2 THE AVERAGE OF THE {IZZONE} NEAREST ZONES
    MW[6][I]=LOWEST(6,{IZZONE})/({IZZONE}*2) ; INTRAZONAL HOV TOLL = 1/2 THE AVERAGE OF THE {IZZONE} NEAREST ZONES
    MW[7][I]=LOWEST(7,{IZZONE})/({IZZONE}*2) ; INTRAZONAL HOV DISTANCE = 1/2 THE AVERAGE OF THE {IZZONE} NEAREST ZONES
    MW[8][I]=LOWEST(8,{IZZONE})/({IZZONE}*2) ; INTRAZONAL HOV TIME = 1/2 THE AVERAGE OF THE {IZZONE} NEAREST ZONES
    MW[9][I]=LOWEST(9,{IZZONE})/({IZZONE}*2) ; INTRAZONAL HOV TIME+TOLL = 1/2 THE AVERAGE OF THE {IZZONE} NEAREST ZONES
  ELSE  ; for external stations
    MW[1][I]=0
    MW[2][I]=0
    MW[3][I]=0
    MW[5][I]=0
    MW[6][I]=0
    MW[7][I]=0
    MW[8][I]=0
    MW[9][I]=0
  ENDIF
    

JLOOP
    ; BUILDS TERMINAL TIME MATRIX
    ATYPEI=ATYPE[I]
    ATYPEJ=ATYPE[J]
    TERMTI=TERMTIME(1,ATYPEI)
    TERMTJ=TERMTIME(1,ATYPEJ)
    MW[4]=TERMTI+TERMTJ
 IF ((99999=MW[3]) | (99999=MW[3]*2)) 
   MW[1]=0 ; Set NOACCESS = 0
   MW[2]=0 ; Set NOACCESS = 0
   MW[3]=0 ; Set NOACCESS = 0
   MW[5]=0 ; Set NOACCESS = 0
   MW[6]=0 ; Set NOACCESS = 0
   MW[7]=0 ; Set NOACCESS = 0
   MW[8]=0 ; Set NOACCESS = 0
   MW[9]=0 ; Set NOACCESS = 0
 ENDIF
ENDJLOOP

ENDPROCESS


ENDRUN
