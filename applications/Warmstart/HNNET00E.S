; Do not change filenames or add or remove FILEI/FILEO statements using an editor. Use Cube/Application Manager.
RUN PGM=NETWORK PRNFILE="C:\NERPM43\APPLICATIONS\WARMSTART\HNNET00E.PRN" MSG='Process Highway Network'
FILEI LINKI[1] = "C:\NERPM43\APPLICATIONS\WARMSTART\MicroCodedHnet42.net"
FILEI LOOKUPI[2] = "C:\NERPM43\APPLICATIONS\WARMSTART\SPDCAP.CSV"
FILEI LOOKUPI[1] = "C:\NERPM43\APPLICATIONS\WARMSTART\VFACTORS_10A.csv"
FILEI LINKI[2] = "C:\NERPM43\APPLICATIONS\WARMSTART\TOLLLINK_10A.DBF"
FILEO LINKO = "C:\NERPM43\APPLICATIONS\WARMSTART\LINK4CNT.DBF",
FORMAT=DBF,INCLUDE=A,B
FILEO NETO = "C:\NERPM43\APPLICATIONS\WARMSTART\TEMP.NET",
EXCLUDE=LINKCNT


;PROCESS  PHASE=INPUT
;Use this phase to modify data as it is read, such as recoding node numbers.

;ENDPROCESS

;PROCESS  PHASE=NODEMERGE  
; Use this phase to make computations and selections of any data on the NODEI files.


;ENDPROCESS

PAR  LIST_ERRS=0 MAX_IP_ERRS=10000
ARRAY _ATCNT=99,_FTCNT=99
LOOKUP, NAME=VFACTORS, 
    LOOKUP[1]=1, RESULT=2,
    LOOKUP[2]=1, RESULT=3,
    LOOKUP[3]=1, RESULT=4,
    LOOKUP[4]=1, RESULT=5,
    INTERPOLATE=N, LOOKUPI=1
LOOKUP, NAME=SPDCAP, 
    LOOKUP[1]=1, RESULT=2,
    LOOKUP[2]=1, RESULT=3,
    INTERPOLATE=N, LOOKUPI=2

PROCESS PHASE=LINKMERGE

; Put toll link variables on network
  ;TOLL TOLLTYPE A B PLZADESC PLZALNSMIN PLZALNSMAX CARTOLL SVCMINUTES SVCSECONDS DECELCODE ACCELCODE EXACTCHGLN AVILANES PCTTRUCKS

; calculate distance in network
  distance=ROUND(100*sqrt((a.x-b.x)^2+(a.y-b.y)^2)/{units})/100

 ; PUT VFACTORS ON NETWORK
  UROADFACTOR=VFACTORS(1,FTYPE_10A)
  CONFAC=VFACTORS(2,FTYPE_10A)
  BPRCOEFFICIENT=VFACTORS(3,FTYPE_10A)
  BPREXPONENT=VFACTORS(4,FTYPE_10A)

; PUT SPEEDS AND CAPACITIES ON NETWORK
  _INDEXVAL=10000*ATYPE_10A+100*FTYPE_10A+LANES_10A

  CAPACITY=SPDCAP(1,_INDEXVAL)
  SPEED=SPDCAP(2,_INDEXVAL)

  IF (SPEED!=0)
    TIME=ROUND(100*60*distance/speed)/100
  ENDIF
  if (time<0.01) time=0.01

; put walktime on network
WALKTIME=ROUND(distance/({avgwlkspd}/60))
ENDPROCESS

;PROCESS  PHASE=SUMMARY   
; Use this phase for combining and reporting of working variables.

;ENDPROCESS

ENDRUN
