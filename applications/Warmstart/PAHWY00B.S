; Do not change filenames or add or remove FILEI/FILEO statements using an editor. Use Cube/Application Manager.
RUN PGM=HIGHWAY PRNFILE="C:\NERPM43\APPLICATIONS\WARMSTART\PAHWY00B1.PRN" MSG='Develops Preload Skims'
DistributeINTRASTEP ProcessID='NERPM4Dist', ProcessList=1-4
FILEI TURNPENI = "C:\NERPM43\APPLICATIONS\WARMSTART\tcards_{Year}{alt}.pen"
FILEI LOOKUPI[1] = "C:\NERPM43\APPLICATIONS\WARMSTART\TERMTIME.CSV"
FILEO MATO[1] = "C:\NERPM43\APPLICATIONS\WARMSTART\PRELSKIMS_24Hr.MAT",
 MO=1-9, NAME=Toll,Distance,Time,WtdTime,HOVToll,HOVDistance,HOVTime,HOVWtdTime,TerminalTime,dec=9*2

PAR ZONEMSG=100

; ARRAY TERMINAL TIMES INTO MEMORY
ARRAY ATYPE={ZONESA}
LOOKUP NAME=TERMTIME, LOOKUP[1]=1, RESULT=2, INTERPOLATE=N, LOOKUPI=1
PROCESS PHASE=LINKREAD
   LW.TIME=ROUND(100*LI.TIME_1)/100
   LW.DISTANCE=LI.DISTANCEFT/5280 ; CONVERTS NETWORK DISTANCES (FEET) TO MILES FOR SKIM TABLES
   IF (LI.FACILITY_TYPE=80-89) ADDTOGROUP=1
   IF (LI.FACILITY_TYPE=49 | LI.FACILITY_TYPE=59 | LI.FACILITY_TYPE=69) ADDTOGROUP=9
   IF (A<={ZONESA})  ; FLAGS LAST ENCOUNTERED LINK FOR TERMINAL TIME CALCULATION LATER
        ATYPE[A]=LI.AREA_TYPE
        PRINT LIST=A,LI.AREA_TYPE
   ENDIF
ENDPROCESS

PROCESS PHASE=ILOOP
   PATHLOAD PATH=LW.TIME, PENI=1,
      MW[1]=PATHTRACE(LI.CARTOLL), NOACCESS=0,
      MW[2]=PATHTRACE(LW.DISTANCE), NOACCESS=0,
      MW[3]=PATHTRACE(LI.TIME), NOACCESS=0,
      MW[4]=PATHTRACE(LW.TIME), NOACCESS=0,
      EXCLUDEGROUP=1,9
   PATHLOAD PATH=LW.TIME, PENI=1,
      MW[5]=PATHTRACE(LI.CARTOLL), NOACCESS=0,
      MW[6]=PATHTRACE(LW.DISTANCE), NOACCESS=0,
      MW[7]=PATHTRACE(LI.TIME), NOACCESS=0,
      MW[8]=PATHTRACE(LW.TIME), NOACCESS=0,
      EXCLUDEGROUP=9
;(precede this comment with block comment to disable) intrazonal array
deno={AVEZONE}*2
loop _ww=1,8
  mw[_ww][i]=lowest(_ww,{AVEZONE})/deno
endloop
; set intrazonal array to zero for cost
mw[1][i]=0
mw[5][i]=0
;(precede this comment with block comment to close disable) END DISABLE INTRAZONAL CALCULATIONS

; BUILD TERMINAL TIME MATRIX
JLOOP
    ATYPEI=ATYPE[I]
    ATYPEJ=ATYPE[J]
    TERMTI=TERMTIME(1,ATYPEI)
    TERMTJ=TERMTIME(1,ATYPEJ)
    MW[9]=TERMTI+TERMTJ
ENDJLOOP

ENDPROCESS



ENDRUN
