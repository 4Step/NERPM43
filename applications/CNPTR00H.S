; Do not change filenames or add or remove FILEI/FILEO statements using an editor. Use Cube/Application Manager.
RUN PGM=PUBLIC TRANSPORT PRNFILE="C:\NERPM50\APPLICATIONS\CNPTR00C.PRN" MSG='Peak period connectors'

; Inputs to walk connectors
FILEI FACTORI[1] = "{SCENARIO_DIR}\output\WalkPrj.FAC"
FILEI FAREI = "{SCENARIO_DIR}\input\TFARES_{year}{alt}.FAR"
FILEI SYSTEMI = "{CATALOG_DIR}\parameters\SYSTEM.PTS"
FILEI LINEI[1] = "{SCENARIO_DIR}\input\TROUTE_{year}{alt}.LIN"

; Input files for AutoCon
; Drive access files & settings

; Outputs
FILEO NTLEGO = "C:\NERPM50\APPLICATIONS\CNPTR00B.NTL"
FILEO REPORTO = "C:\NERPM50\APPLICATIONS\CNPTR00D.PRN"
FILEO NETO = "C:\NERPM50\APPLICATIONS\CNPTR00B.NET"

; OVERALL PARAMETERS OF RUN
PARAMETERS USERCLASSES=1,FARE=N, MAPSCALE=5280, HDWAYPERIOD=2,
           NOROUTEERRS=999999, NOROUTEMSGS=999999,
           TRANTIME=LW.TRANTIME,
           TRANTIME[21]=LI.M21TIMEOP,
           TRANTIME[22]=LI.M22TIMEOP,
           TRANTIME[23]=LI.M23TIMEOP,
           TRANTIME[27]=LI.M27TIMEOP

REPORT LINES=T
REREPORT LINES=T, TRNLEGS3=T
PROCESS PHASE=LINKREAD
 LW.TRANTIME=LI.M21TIMEOP
 LW.WALKTIME=LI.WALKTIME
 LW.WALKDISTANCE=LI.DISTANCE
 LW.DISTANCE=LI.DISTANCE
 LW.ADJDISTANCE=LI.ADJDISTANCE
ENDPROCESS

PROCESS PHASE=DATAPREP

  ; 1 - WALK ACCESS/EGRESS
  GENERATE, COST=(LW.ADJDISTANCE),EXTRACTCOST=(LW.WALKTIME),MAXCOST=200*{WALKACCESSDIST},LIST=N,EXCLUDELINK=(LI.FACILITY_TYPE=10-19,69,70-99),
            NTLEGMODE=1,MAXNTLEGS=200*{MAXWLKACCLNKS},DIRECTION=3,ONEWAY=F,FROMNODE=1-{ZONESI},TONODE={NODEMIN}-99999

 ; Add AUTOCON outputs
 list='\nGenerate Zone Access/Egress Legs'
    GENERATE, 
       PNR=T,
       KNR=F,
       PERIOD=1,
       
       PNRMODE=2,
       KNRMODE=3,
       INTERNALZONES=1-2494,
       
       CBDZONE=730,
       ORIGINTERMTIME=2.0,
       DEFDRIVETIME=20.0,
       CHECKRELEVANCE=1,
       CHECKBACKTRACK=1,
       MAXBACKDIST=4.0,
       MAXBACKFACTOR=0.30,
       DISTANCEFACTOR=5280,
       
       PREMIUMMODE=0,1,0,1,1,1,1,  
       MODEPRIORITY=7,5,7,2,1,4,3,
       
       VOT=6,3,
       OVTRATIO=2,2,
       AATRATIO=1.5,1.5,
       AUTOCCPNR=1.2,
       AUTOCCKNR=1.2,
       AOC=9.5,
       INFLTRANSITFARE=0.9487,
       INFLAOC=1,
       INFLPARKINGCOST=1.1976,
       MAXCHECK = 10,
       MAXCONN = 5,
       
       CONNREPORT=1,
       GENREPORT=2,
       TIMEMAT=MI.1.4,
       DISTMAT=MI.1.2,
       AUTOMATCH=T      ; T=original logic, F=Enhanced logic

  ENDPROCESS

ENDRUN
